<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">

    <title>Dutch Auction System</title>
</head>

<body>

    <header>
        DUTCH AUCTION SYSTEM
    </header>

    <div id="nft-info">
        <img src="uploads/images/<%= name %>" alt="An image" width="200px" />
        <br /><br />
        File: <%= name %> <br /><br />
            SHA-256 Hash: <%= hash %>
                <br /><br />
                Current Price (in $):
                <h3 id="price">
                    <%= bid %>
                </h3>

                <br />


                <button id="buynow" onclick="stopTimer();">BUY NOW!</button>

                <div id="table">
                    <table style="width:50%" id="myTable">
                        <tr>
                            <th>Bidders</th>
                            <th>Price</th>
                            <th>Time</th>
                        </tr>

                        <tr>
                            <td>Roshan Parajuli (Seller)</td>
                            <td>
                                <%= bid %> $
                            </td>
                            <td>3/12/2021</td>
                        </tr>

                    </table>
                </div>
    </div>

    <script>

        function getTime() {
            var currentdate = new Date();
            var datetime = currentdate.getDate() + "/"
                + (currentdate.getMonth() + 1) + "/"
                + currentdate.getFullYear() + " @ "
                + currentdate.getHours() + ":"
                + currentdate.getMinutes() + ":"
                + currentdate.getSeconds();

            console.log(datetime);
        }

        var stop;
        function timer(interval = 5000) {

            stop = false;

            function loop(count = 1) {

                if (stop) {
                    return;
                }

                document.getElementById("price").innerText = parseFloat(document.getElementById("price").innerText) - 0.1;

                setTimeout(loop, interval, ++count);
            }
            loop();
        }

        function stopTimer() {
            stop = true;

            var currentdate = new Date();
            var datetime = currentdate.getDate() + "/"
                + (currentdate.getMonth() + 1) + "/"
                + currentdate.getFullYear() + " @ "
                + currentdate.getHours() + ":"
                + currentdate.getMinutes() + ":"
                + currentdate.getSeconds();

            console.log(datetime);

            name_inserted = prompt("Enter your name:");

            var table = document.getElementById("myTable");
            var row = table.insertRow();
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            cell1.innerHTML = name_inserted;
            cell2.innerHTML = document.getElementById("price").innerText + "$";
            cell3.innerHTML = datetime;


            //document.getElementById("fill-data").innerHTML += "<tr><td> Suman Raj Khanal</td><td>12/3 9:23 AM</td></tr>";

            //window.alert("You have bought the NFT at " + document.getElementById("price").innerText + "$ !");
        }


        window.onload = function () {
            //time is set in milliseconds
            setTimeout(timer, 10000)
        };


    </script>




</body>

</html>